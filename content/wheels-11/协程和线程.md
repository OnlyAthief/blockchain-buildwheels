# 协程和线程

### 线程

线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。

### 协程

协程是一种用户态的轻量级线程，协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。没有生命周期。

### 协程与线程比较

- 1.一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样JAVA中则能使用多核CPU。
- 2.线程进程都是同步机制，而协程则是异步。
- 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态。

### 协程的好处

- 1)跨平台
- 2)跨体系架构
- 3)无需线程上下文切换的开销
- 4)无需原子操作锁定及同步的开销
- 5)方便切换控制流，简化编程模型
- 6)高并发+高扩展性+低成本：一个CPU支持上万的协程都不是问题。所以很适合用于高并发处理。

### 协程的缺点

- 1.无法利用多核资源：协程的本质是个单线程,它不能同时将 单个CPU 的多个核用上,协程需要和进程配合才能运行在多CPU上.当然我们日常所编写的绝大部分应用都没有这个必要，除非是cpu密集型应用。
- 2.进行阻塞（Blocking）操作（如IO时）会阻塞掉整个程序：这一点和事件驱动一样，可以使用异步IO操作来解决

### 协程在Go中的使用

go func(){}

go语言的协程库是使得其性能优异。


![](http://chuantu.biz/t6/340/1531032363x-1376440162.jpg)
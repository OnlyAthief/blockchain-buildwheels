# 侧链和跨链深度研究

主链和侧链都使用主链代币作为系统货币。其实质是通过双向锚定机制实现主链货币价值向侧链体系的转移，从而在侧链上使用这部分从主链转移过来的主链货币的价值，至于这部分主链货币价值背书而产生，发行的侧链货币的名称，则可以按需自由命名。

### 双向挂钩技术

双向挂钩（2WP）是侧链实现的核心原理。

允许将主链代币从主链转移到辅助区块链，反之亦然。

转移实际上是一种错觉，主链代币其实并没有转移，但在主链上被暂时锁定，而同时在侧链上有相同数量的等价token被解锁。当等量的token在侧链上被再次锁定时，原先的主链上的代币会被解锁。

这个时候主链代币跟token之间是有一个兑换汇率的，这个兑换汇率是对侧链token的一个基础价格支撑，也就是说侧链项目运营得再差劲，也能兑换回主链的代币，如果运营得足够好，其token价值也会上升，同时也能提升主链代币价值。

双向挂钩技术的具体实现选择：

- 1.单一托管模式
	- 概念：将主链代币发到一个单一托管方地址，类似一个交易所，完全信任这个托管方，然后托管方收到代币后在侧链上激活相应token
	- 优点：不要改动主链
	- 缺点：完全中心化方案
- 2.联盟模式
	- 概念：公证人联盟取代单一的托管方，托管方个人地址换成公证人联盟的多重签名地址
	- 优点：不要改动主链，相信一个公证人联盟不作恶比想象一个人好一点
	- 缺点：还是比较中心化
- 3.SPV模式
	- 概念：用户在主链上将数字资产发送到主链的一个特殊地址锁定主链的相应代币，随后创建一个SPV证明并发送到测量上。一个对应的带有SPV证明的交易会出现在侧链上，同时验证主链上的数字资产已经被锁住，就可以在侧链上激活相应token。如果主链代币要发送回主链，交易被发送到侧链上锁定的输出中，在一定的等待时间后，可以创建一个SPV证明，将其发送回主链上，解锁主链上的相应代币。
	- 优点：解决主链性能瓶颈问题，更好地实现智能合约，保护区块链的隐私
	- 缺点：对主链进行软分叉
- 4.驱动链模式
	- 概念：矿工作为算法代理监护人，监管被锁定的主链代币，投票决定何时解锁主链代币和将解锁的主链代币发送到何处
	- 优点：矿工在驱动链中的参与程度越高，系统安全度越高
	- 缺点：对主链进行软分叉
- 5.混合模式
	- 概念：在主链和侧链上使用不同的解锁方法
	- 优点：提高了处理效率
	- 缺点：对主链进行软分叉

### 跨链技术

区块链是一个独立的账本，要在两个没有关联的账本上进行价值的转移，就需要跨链技术。跨链并没有改变每个区块链上的价值总额，只是不同的持有人之间进行了一个兑换而已。

跨链技术就是一个撮合，让一条链上的用户Alice找到另外一条链上的Bob进行兑换，本质上跟一个交易所进行币币兑换差不多。

如果用跨链技术来进行交易所的设计，交易所就是跑在一个公有链上，任何人都能参与到这个交易所的运行中。

四种主流的跨链技术：

- 1.公证人机制（Notary shemes）
	- 概念：使用受信任的团体向一条链声明另一链上发生了某事件，或者确定该声明是正确的。团体既可以自动地监听和响应事件，也可以在被请求的时候进行监听和响应事件。
	- 特点：两个想要交易的个体互相不信任，引入第三方充当公证人作为中介，提供一个底层加密托管的连接者，让资金在各账本间流动。
	- 优点：链与链互操作简单，不需要工作证明和复杂证明。
	- 缺点：中心化。
- 2.侧链/中继（Sidechains/relays）
	- 概念：区块头有Merkle等证明信息，将A区块链的某个区块头写入B区块链的区块，A链和B链一样的共识验证方法，等待A链的区块头序列之后，B链可以通过Merkle分支的证明信息来证明A链的数据和操作。
	- 特点：链与链之间可以有一个通道，如果通道本身就是区块链，那就是中继链。
	- 优点：中继器/侧链都能支持跨链资产变换转移，跨链合约和资产抵押。
	- 缺点：侧链从技术层面讲实现很难。
- 3.哈希锁定（Hash-locking）
	- 概念：简单来说是两条链在规定时间内收到解锁信息，然后发送资产。
	- 特点：哈希锁定源于比特币闪电网络。
	- 优点：可以不用公证人，让链与链之间尽可能少的了解彼此。
	- 缺点：没实现跨链资产的转移，没实现跨链合约，应用场景受限。
- 4.分布式私钥控制（Distributed private key control）
	- 概念：利用一个基于协议的内置资产模板，根据跨链交易信息部署新的智能合约的创建新的资产。当一种已注册资产由原有链转移到跨链上时，跨链节点会为用户在已有合约中发放相应等值代币，确保了原有链资产在跨链上仍然可以相互交易流通。
	- 特点：委托去中心化的网络掌握用户私钥，事实上用户同时还掌握自身代理资产的部分私钥，所以这笔资产从来没有离开用户的掌控，并没有像中心化的交易所一样，完全用第三方来掌握这个资产。
	- 优点：用户并没有失去对这笔资产的控制权，拥有私钥才是拥有对这笔资产的控制权。
	- 缺点：智能合约还需要更多方面实现。


##### 跨链技术的应用

- 1.可转移的资产：资产可以多链之间来回转移和使用。
- 2.原子交易：链间资产的同时交换。
- 3.跨链数据预言机：链A需要得知链B的数据的证明。
- 4.跨链执行合约：例如根据链A的股权证明在链B上分发股息。
- 5.跨链交易所：对于协议不直接支持跨链操作的区块链进行补充。

### 公链拥堵的尝试方案

- 侧链
	- 主链和其他区块链的资产进行相互转移
	- 锚定主链为基础的新型区块链，比如闪电网络
- 分片
	- 将大型数据库分成更小，更快，更容易管理的部分
	- 将区块链网络划分成若干能够处理交易的较小组件式网络，应用到区块链是比较复杂的，比如进行分片尝试的以太坊
- DAG
	- 常用的数据结构，经常被用到处理动态规划，导航中寻找最短路径，数据压缩等场景中
	- 摒弃区块的概念，交易直接进入全网中，速度快得多。DAG把交易确认的环境直接下放给交易本身，无需由矿工打包池化层区块后同意交易顺序，没有矿工的角色，极低的手续费，适合小额高频交易。比如IOTA

### 侧链的神奇之处

- 1.小额的交易走侧链，隐蔽主账户地址。
- 2.大量小额交易走侧链，加快转账速度，减轻主网的压力。
- 3.侧链锁定主网价值的同时，开发智能合约的功能。
- 4.侧链以融合的方式实现加密货币金融生态的目标。侧链使区块链可以支持多种资产类型，以及小微支付，智能合约，安全处理机制，财产注册等，并可以增强区块链的隐私保护。


### 侧链/跨链目前的问题

- 侧链攻击问题

攻击最薄弱的侧链，破坏整个网络。在某个侧链完成51%攻击，创建一个假的最长侧链，伪造的侧链币在主链上兑换主链代币。
之所以出现这种情况，侧链跟主链并不共享一个公共块历史。链间之间转移币的过程，依赖SPV证明，只检查所涉及的币是否来自已知的最长链。	

- 合并挖矿带来中心化挖矿

解决侧链攻击问题的一个办法是合并挖矿，确保所有侧链同时以相同哈希率开采。合并挖矿的情况下，所有侧链使用相同的哈希算法，同一时刻为多个侧链生成工作量证明。矿工只需要一次哈希运算就有相同概率完成多个工作量证明。
合并挖矿带来的中心化挖矿的逻辑：侧链引入矿工费，大矿池能收到更多的交易，打包区块能获得更多的收益，所以会带动矿工加入一个中心化的矿池能获得最大的收益。

当然上面说的主链是比特币，属于PoW挖矿，如果主链都不是PoW挖矿，侧链进行联合挖矿是否还会带来挖矿中心化的趋势，这就不一定了。

- 侧链的中心化问题

侧链可以帮主链打开一个快速流动的通道，但引发了长期的关于中心化和去中心化的争论。

- 跨链的稳定性有待提高

跨链的意义在于能够不经过中心化的交易所就能直接转换不同公链之间的价值，但其稳定性和转账速度仍然是用户现在使用的最大障碍。